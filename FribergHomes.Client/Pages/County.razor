@* Author: Reb 2024-04-26*@
@page "/county"
@using FribergHomes.Client.DTOs
@using FribergHomes.Client.Services.Interfaces
@using FribergHomes.Client.Components
@using System.Text.Json
@using BlazorBootstrap
@inject ICounty countyService

<h3>Kommun</h3>

<hr />

<Search></Search>

@* <h4>Search as you write</h4>

<input type="text" value="@countyName" @oninput="@FilterDtos" placeholder="Sök efter kommun..." />
@if(FilteredDto != null)
{
    <div class="dropdown">
        <ul class="dropdown-list">
            @foreach (var county in FilteredDto)
            {
                <li class="dropdown-item" @onclick="(e) => GetCounty(county.Name)" style="cursor: pointer">@county.Name</li>
            }
        </ul>
    </div>
}
@if (CountyDto != null)
{
       <GetById ObjectId="@CountyDto.Id" ObjectType="County" /> 
}

<hr />


<h4>Sök kommun via Id:</h4>
<form @onsubmit="SubmitId">
    <input type="number" @bind="countyId" />
    <button type="submit">Hämta kommun</button>
</form>
@if (countyId != 0)
{
    <GetById ObjectId="@countyId" ObjectType="County" ObjectToShow="null" />
} *@


@code {
    private CountyDTO? CountyDto { get; set; }

    private List<CountyDTO> CountiesDtos;

    private int countyId = 0;
    private string countyName = "";

    private List<CountyDTO> FilteredDto;


    private void FilterDtos(ChangeEventArgs args)
    {
        countyName = args.Value.ToString();
        FilteredDto = CountiesDtos.Where(c => c.Name.ToLower().Contains(countyName.ToLower())).ToList();
        StateHasChanged();
    }
    private async Task GetCounty(string name)
    {
        CountyDto = await countyService.GetCountyByNameAsync(name);
        StateHasChanged();
    }

    private async void SubmitId()
    {
        CountyDto = await countyService.GetCountyByIdAsync(countyId);
        StateHasChanged();
    }
    private async void SubmitName()
    {
        CountyDto = await countyService.GetCountyByNameAsync(countyName);
        StateHasChanged();
    }

    protected override async Task OnInitializedAsync()
    {
        CountiesDtos = await countyService.GetAllCountiesAsync();
        StateHasChanged();
    }
}
