@* Gets Object by Id
* Started this just to test
* @ Author: Rebecka 2024-04-26
*@
@using System.Text.Json
@using System.Net.Http.Json
@using FribergHomes.Client.Services.Interfaces;
@using FribergHomes.Client.DTOs
@inject IRealtor realtorService
@inject ICategory categoryService
@inject ICounty countyService
@inject IAgencyService agencyService
@inject ISalesObject salesService


@if (ObjectToShow != null)
{
    <div class="card shadow">
        @if (ObjectToShow is RealtorDTO realtor)
        {

            <h2>@realtor.FullName - @realtor.Agency</h2>
            <div class="pictures">
                <img src="@realtor.Picture" width="300" />
                <img src="@realtor.AgencyLogo" width="150" id="agencyLogo" />
            </div>
            <p>@realtor.Email</p>
            <p>@realtor.PhoneNumber</p>

        }
        else if (ObjectToShow is SalesObjectDTO salesObject)
        {
            <h3>@salesObject.Adress</h3>
            foreach (var picture in salesObject.ImageLinks)
            {
                <img src="@picture" width="500" />
            }
            if (salesObject.CurrentPrice > salesObject.ListingPrice)
            {
                <del>@salesObject.ListingPrice kr</del>
                <p>@salesObject.CurrentPrice kr</p>
            }
            else
            {
                <p>@salesObject.CurrentPrice kr</p>
            }
            <p>@salesObject.CategoryName</p>
            <img src="@salesObject.CategoryLogoUrl" width="50" />
            <p>Rum @salesObject.Rooms</p>
            <p>Byggnadsår: @salesObject.BuildYear</p>
            <p>Boarea: @salesObject.LivingArea m<sup>2</sup></p>
            if(salesObject.AncillaryArea > 0)
            {
            <p>Biarea: @salesObject.AncillaryArea m<sup>2</sup></p>
            }
            if (salesObject.CategoryName == "Apartment")
            {
                <p>Våning: @salesObject.Level</p>
                if (salesObject.Lift == true)
                {
                    <p>Hiss: Ja</p>
                }
                else
                {
                    <p>Hiss: Nej</p>
                }
            }
            else
            {
                <p>Tomtarea: @salesObject.PlotArea m<sup>2</sup></p>
            }
            <p>Driftkostnad: @salesObject.YearlyCost kr</p>
            <p>Månadsavgift: @salesObject.MonthlyFee kr</p>
            <p>
                Visningsdatum:
                @foreach (var date in salesObject.ViewingDates)
                {
                    date.ToString("YYYY-mm-dd");
                }
            </p>
            <h4>Beskrivning:</h4>
            <p>@salesObject.ObjectDescription</p>
            <h3>Mäklare</h3>
            <p>@salesObject.RealtorName - @salesObject.AgencyName</p>
            <p>@salesObject.RealtorEmail</p>
            <p>@salesObject.RealtorPhone</p>
            <img src="@salesObject.AgencyLogoUrl" width="50" />
        }
        else if (ObjectToShow is AgencyDTO agency)
        {
            <h2>@agency.Name</h2>
            <img src="@agency.Logo" width="300" />
        }
        else if (ObjectToShow is CountyDTO county)
        {
            <h2>@county.Name</h2>
        }
        else if (ObjectToShow is CategoryDTO category)
        {
            <h2>@category.Name</h2>
            <img src="@category.IconUrl" width="200" />
        }
    </div>
}

@code {

    [Parameter]
    public string? ObjectType { get; set; }

    [Parameter]
    public int ObjectId { get; set; }

    [Parameter]
    public object? ObjectToShow { get; set; }

    private async Task GetObject()
    {
        if (ObjectType == "Realtor")
            ObjectToShow = await realtorService.GetRealtorByIdAsync(ObjectId);
        else if (ObjectType == "SalesObject")
            ObjectToShow = await salesService.Get(ObjectId);
        else if (ObjectType == "Category")
            ObjectToShow = await categoryService.GetCategoryByIdAsync(ObjectId);
        else if (ObjectType == "County")
            ObjectToShow = await countyService.GetCountyByIdAsync(ObjectId);
        else if (ObjectType == "Agency")
            ObjectToShow = await agencyService.GetAgencyByIdAsync(ObjectId);
    }

    protected override async Task OnInitializedAsync()
    {
        await GetObject();
    }

}
