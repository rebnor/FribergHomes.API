@* Gets Object by Id
* Started this just to test
* @ Author: Rebecka 2024-04-26
* @ Update: All-around update on code/ Reb 30/4 - 1/5
* @Update: Added so you click on button to come på infopage about choosen object / Reb 2024-05-02
* @Update: Implemented EditButton component where required. / Tobias 2024-05-03
* @Update: Added <AuthorizeView Roles="Realtor, Admin"> where its needed / Reb 2024-05-16
* @Update: Changed RealtorID from int to string /Sanna 
*@
@using System.Text.Json
@using System.Net.Http.Json
@using FribergHomes.Client.Authentications
@using FribergHomes.Client.Services.Interfaces;
@using FribergHomes.Client.DTOs
@inject IRealtor realtorService
@inject ICategory categoryService
@inject ICounty countyService
@inject IAgencyService agencyService
@inject ISalesObject salesService
@inject IAuthService authService;

@if (ObjectToShow != null)
{
    <div class="shadow col-6 col-sm-3 text-center card custom-card">
        @if (ObjectToShow is RealtorDTO realtor)
        {
            <h2>@realtor.FullName - @realtor.AgencyName</h2>
            <div class="pictures">
                <img src="@realtor.Picture" width="100" />
            </div>
            <p>@realtor.Email</p>
            <p>@realtor.PhoneNumber</p>

            <Button Color="ButtonColor.Info">
                <a href="/info/Realtor/@realtor.Id" class="custom-link">Kolla info om Mäklare</a>
            </Button>
        }
        else if (ObjectToShow is SalesObjectDTO salesObject)
        {
            if (salesObject.CurrentPrice > salesObject.ListingPrice)
            {
                <Badge Color="BadgeColor.Dark">PSST....Sänkt pris</Badge>
            }
            <h3>@salesObject.Adress - @salesObject.CountyName</h3>
            foreach (var picture in salesObject.ImageLinks)
            {
                <div>
                <img src="@picture" width="100" />
                </div>
            }
            <strong>@salesObject.CategoryName</strong>
            <div>@((MarkupString)salesObject.CategoryLogoUrl)</div>// TODO: Syns inte

            if (salesObject.CurrentPrice > salesObject.ListingPrice)
            {
                <del>@salesObject.ListingPrice kr</del>
                <h4>@salesObject.CurrentPrice kr</h4>
            }
            else
            {
                <h4>@salesObject.CurrentPrice kr</h4>
            }
            <p><strong>Rum: </strong>@salesObject.Rooms</p>
            <p><strong>Boarea: </strong>@salesObject.LivingArea m<sup>2</sup></p>
            if (salesObject.CategoryName == "Lägenhet")
            {
                <p><strong>Våning: </strong>@salesObject.Level</p>
                if (salesObject.Lift == true)
                {
                    <p><strong>Hiss: </strong>Ja</p>
                }
                else
                {
                    <p><strong>Hiss: </strong>Nej</p>
                }
            }
            else
            {
                <p><strong>Tomtarea: </strong>@salesObject.PlotArea m<sup>2</sup></p>
            }
            <h4>Mäklare</h4>
            <strong>@salesObject.RealtorName</strong>
            <img src="@salesObject.AgencyLogoUrl" width="70"/>

            <Button Color="ButtonColor.Info">
                <a href="/info/SalesObject/@salesObject.Id" class="custom-link">Kolla info</a>
            </Button>
        }
        else if (ObjectToShow is AgencyDTO agency)
        {
            <h3>@agency.Name</h3>
            <img src="@agency.Logo" width="100" />

            <div class="make-space"></div>


            <Button Color="ButtonColor.Info">
                <a href="/info/Agency/@agency.Id" class="custom-link">Kolla info om Mäklarbyrå</a>
            </Button>
        }
        else if (ObjectToShow is CountyDTO county)
        {
            <h2>@county.Name</h2>

            <Button Color="ButtonColor.Info">
                <a href="/info/County/@county.Id" class="custom-link">Kolla info om Kommun</a>
            </Button>
        }
        else if (ObjectToShow is CategoryDTO category)
        {
            <h2>@category.Name</h2>
            <h1>@((MarkupString)category.IconUrl)</h1>

            <div class="make-space"></div>

            <Button Color="ButtonColor.Info">
                <a href="/info/Category/@category.Id" class="custom-link">Annonser i denna Kategori</a>
            </Button>
        }
    </div>
}
else
{
    <p>@error</p>
}

@code {

    [Parameter]
    public string? ObjectType { get; set; }

    [Parameter]
    public int ObjectId { get; set; }

    [Parameter]
    public string ObjectStringId { get; set; }

    public object? ObjectToShow { get; set; }
    public string error;

    private AuthenticationState authState;

    private async Task GetObject()
    {
        try
        {
            if (ObjectType == "Realtor")
                ObjectToShow = await realtorService.GetRealtorByIdAsync(ObjectStringId);
            if (ObjectType == "SalesObject")
                ObjectToShow = await salesService.Get(ObjectId);
            else if (ObjectType == "Category")
                ObjectToShow = await categoryService.GetCategoryByIdAsync(ObjectId);
            else if (ObjectType == "County")
                ObjectToShow = await countyService.GetCountyByIdAsync(ObjectId);
            else if (ObjectType == "Agency")
                ObjectToShow = await agencyService.GetAgencyByIdAsync(ObjectId);

        }
        catch (Exception ex)
        {
            error = "Tyvärr så finns inte detta id! Försök igen.";
        }
    }

    protected override async Task OnInitializedAsync()
    {
        await GetObject();
        authState = await authService.CheckAuthState();
        StateHasChanged();

    }
}
