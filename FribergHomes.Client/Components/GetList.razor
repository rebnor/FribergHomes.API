@using System.Text.Json
@using System.Net.Http.Json
@using FribergHomes.Client.Services.Interfaces;
@using FribergHomes.Client.DTOs
@inject IRealtor realtorService
@inject ICategory categoryService
@inject ICounty countyService
@inject IAgencyService agencyService
@inject ISalesObject salesService
@typeparam TItem



@if (ListToShow != null)
{
    <div class="row text-center">

        @foreach (var item in ListToShow)
        {
            <div class="col-md-4">
                <div class="card p-3 m-4">

                    @if (item is RealtorDTO realtor)
                    {
                        <h2>@realtor.FullName - @realtor.Agency</h2>
                        <div class="pictures">
                            <img src="@realtor.Picture" width="300" />
                            <img src="@realtor.AgencyLogo" width="150" id="agencyLogo" />
                        </div>
                        <p>@realtor.Email</p>
                        <p>@realtor.PhoneNumber</p>
                    }
                    else if (item is SalesObjectDTO salesObject)
                    {


                        <h3>@salesObject.Adress</h3>
                        foreach (var picture in salesObject.ImageLinks)
                        {
                            <img src="@picture" width="100" />
                        }
                        if (salesObject.CurrentPrice > salesObject.ListingPrice)
                        {
                            <del>@salesObject.ListingPrice kr</del>
                            <p>@salesObject.CurrentPrice kr</p>
                        }
                        else
                        {
                            <p>@salesObject.CurrentPrice kr</p>
                        }
                        <p>@salesObject.CategoryName</p>
                        <img src="@salesObject.CategoryLogoUrl" width="50" />
                        <p>Rum @salesObject.Rooms</p>
                        <p>Byggnadsår: @salesObject.BuildYear</p>
                        <p>Boarea: @salesObject.LivingArea m<sup>2</sup></p>
                        <p>Biarea: @salesObject.AncillaryArea m<sup>2</sup></p>
                        if (salesObject.CategoryName == "Apartment")
                        {
                            <p>Våning: @salesObject.Level</p>
                            if (salesObject.Lift == true)
                            {
                                <p>Hiss: Ja</p>
                            }
                            else
                            {
                                <p>Hiss: Nej</p>
                            }
                        }
                        else
                        {
                            <p>Tomtarea: @salesObject.PlotArea m<sup>2</sup></p>
                        }
                        <p>
                            Visningsdatum:
                            @foreach (var date in salesObject.ViewingDates)
                            {
                                date.ToShortDateString();
                            }
                        </p>
                        <h3>Mäklare</h3>
                        <p>@salesObject.RealtorName - @salesObject.AgencyName</p>
                    }
                    else if (item is AgencyDTO agency)
                    {
                        <h2>@agency.Name</h2>
                        <img src="@agency.Logo" width="300" />
                    }
                    else if (item is CountyDTO county)
                    {
                        <h2>@county.Name</h2>
                    }
                    else if (item is CategoryDTO category)
                    {
                        <h2>@category.Name</h2>
                        <img src="@category.IconUrl" width="200" />
                    }
                </div>
            </div>

        }
    </div>
}


@code {
    [Parameter]
    public string? ObjectType { get; set; }

    [Parameter]
    public int ObjectId { get; set; }

    public List<TItem>? ListToShow;

    private bool isFiltered = false;

    private async Task GetObjects()
    {
        if (ObjectType == "Realtor")
            ListToShow = (List<TItem>)(object)await realtorService.GetAllRealtorsAsync();
        else if (ObjectType == "SalesObject")
            ListToShow = (List<TItem>)(object)await salesService.GetAll();
        else if (ObjectType == "Category")
            ListToShow = (List<TItem>)(object)await categoryService.GetAllCategoriesAsync();
        else if (ObjectType == "County")
            ListToShow = (List<TItem>)(object)await countyService.GetAllCountiesAsync();
        else if (ObjectType == "Agency")
            ListToShow = (List<TItem>)(object)await agencyService.GetAllAgenciesAsync();
    }



    protected override async Task OnInitializedAsync()
    {
        await GetObjects();

    }





}
